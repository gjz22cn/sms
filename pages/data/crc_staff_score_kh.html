<script type="text/javascript">
function sethead() {
    var url = "crc_data.php?method=staff&func=setbi&uid=" + g_uid;
    var params = { 'head_uid':g_pid,
        'head_name':'', 'bi_birth':'', 'bi_fwd':'',
        'head_no':'', 'bi_gs':'', 'bi_major':'',
        'head_cpro':'', 'bi_cpos':'', 'bi_psca':'',
        'head_edu':'', 'bi_cwy':'', 'bi_wti':'',
        'head_owy':'', 'bi_eng':'', 'bi_bim':'',
        'head_cer':'', 'bi_cer2':'', 'bi_act':'',
        'head_actdesc':''};


    for(var x in params) {
        var ee=document.getElementsByName(x);
        if(ee.length == 1) {
            params[x]=ee[0].value;
        }
    }

    //alert(JSON.stringify(params));

    $.ajax({
        type: "post",
        url: url,
        data: "head_uid=" + g_pid + "&baseinfo=" + JSON.stringify(params),
        success: function(msg){
            var result=msg;
            var index = result.indexOf('setbiresult=');
            var res=JSON.parse(result.substr(index+12));
            alert(res.retstr);
        }
    });
}

function showhead(response) {
    var result=response;
    var index = result.indexOf('getbiresult=');
    var bidata=JSON.parse(result.substr(index+12));

    //alert(result);
    autofillformdata(document.forms['form_bi'], bidata);
}

function calcscorecb(response) {
    var tname = "calcscore";
    var resultstr=tname+"result=";
    var index=response.indexOf(resultstr);
    var data=JSON.parse(response.substr(index+resultstr.length));
    var eres=document.getElementById(tname+"_ret");

    alert(response);

    if (data.ret == 0) {
        fillscores(data);
        eres.innerHTML="算分成功!";
    } else {
        eres.innerHTML="算分失败: " + data.retstr + "!";
    }
}

function calcstaffscore() {
    var params = $('#form_kh').serialize();
    params += "&kh_uid=" + g_pid;
    alert(params);
    ajaxRequest("POST", g_staffpre+"&func=calcscore&uid=" + g_uid, params, calcscorecb);
}
</script>


<!-- base info start -->
<form id="form_kh" name="form_kh">
    <table class="scoretbl">
        <tr>
            <td>考核名称</td>
            <td><select name="kh_khname"><option value="2016" selected="selected">2016</option>
                    <option value="2017">2017</option>
                </select></td>
            <td colspan="4" class="error" id="calcscore_ret"></td>
            <td><input type="button" name="head_calcscore" size="8" value="算分" onclick="calcstaffscore()"></td>
        </tr>
        <tr>
            <td><select name="kh_tolc"><option value="正式" selected="selected">正式</option>
                    <option value="劳务">劳务</option>
                </select></td>
            <td>序列</td>
            <td><select name="kh_pc"><option value="技术" selected="selected">技术</option>
                    <option value="质量">质量</option>
                    <option value="资料">资料</option>
                </select></td>
            <td>现职级</td>
            <td><select name="kh_currl"><option value="D级">D级</option>
                    <option value="E、F级" selected="selected">E、F级</option>
                </select></td>
            <td>总分</td>
            <td id="score0"></td>
        </tr>
    </table>
</form>
<!-- base info end -->
