<script type="text/javascript" src="../scripts/jquery.min.js"></script>
<script type="text/javascript">
<?php
    print 'var g_crc="' . ($_GET["crc"]) . '";';
    print 'var g_uid1="' . ($_GET["uid"]) . '";';
    if (isset($_SESSION["staffdata"])) {
        print 'var g_data=' . json_encode($_SESSION["staffdata"]) . ';';
    }
?>

var g_url;
var g_uid='1';
var g_bi_id='1';

function setbi() {
    var url = "crc_data.php?method=staff&func=setbi&uid=" + g_uid1;
    var params = { 'bi_uid':g_uid1,
        'bi_name':'', 'bi_birth':'', 'bi_fwd':'',
        'bi_no':'', 'bi_gs':'', 'bi_major':'',
        'bi_cpro':'', 'bi_cpos':'', 'bi_psca':'',
        'bi_edu':'', 'bi_cwy':'', 'bi_wti':'',
        'bi_owy':'', 'bi_eng':'', 'bi_bim':'',
        'bi_cer':'', 'bi_cer2':'', 'bi_act':'',
        'bi_actdesc':''};


    for(var x in params) {
        var ee=document.getElementsByName(x);
        if(ee.length == 1) {
            params[x]=ee[0].value;
        }
    }

    //alert(JSON.stringify(params));

    $.ajax({
        type: "post",
        url: url,
        data: "bi_uid=" + g_uid + "&bi_id=" + g_bi_id + "&baseinfo=" + JSON.stringify(params),
        success: function(msg){
            var result=msg;
            var index = result.indexOf('setbiresult=');
            var res=JSON.parse(result.substr(index+12));
            alert(res.retstr);
        }
    });
}

function showbi(bidata) {
    autofilldata(bidata, 1);
}

function get_baseinfodata() {
    //创建XMLHttpRequest对象
    var xmlHttp = new XMLHttpRequest();

    //配置XMLHttpRequest对象
    xmlHttp.open("get", "crc_data.php?method=staff&func=getbi&uid=" + g_uid1 + "&bi_uid=" + g_uid + "&bi_id=" + g_bi_id);

    //设置回调函数
    xmlHttp.onreadystatechange = function () {
        if (xmlHttp.readyState == 4 && xmlHttp.status == 200) {
            var result=xmlHttp.responseText;
            var index = result.indexOf('getbiresult=');
            showbi(JSON.parse(result.substr(index+12)));
        }
    }

    //发送请求
    xmlHttp.send(null);
}

function load() {
    var temp_str=window.location.href;
    g_url = temp_str.substr(0, temp_str.indexOf("/crc_staff.php"));

    /* base info */
    get_baseinfodata();
}

function btnaction(type, action, uid, id) {
    var newurl=g_url+'/crc_handler.php?method=staff&func=';

    if (action == 'delete') {
        newurl+=action+type;
    } else {
        newurl+='show'+action+type;
    }
    newurl+='&uid='+g_uid1;
    newurl+='&'+type+'_uid='+uid;
    if (action != 'add') {
        newurl+='&'+type+'_id='+id;
    }
    //alert(newurl);

    if (action == 'delete') {
        top.location=newurl;
    } else {
        OpenWindow(newurl, "test", 'iframe', 1000, 400);
    }
}

function OpenWindow(content, title, type, width, height) {
    var topsize = (window.screen.availHeight-30-height)/2;
    var leftsize = (window.screen.availWidth-10-width)/2;
    var winarg = 'height='+ height +',width=' + width + ',top=' + topsize + ',left=' + leftsize;

    winarg+=',toolbar=no,menubar=no,scrollbars=no,resizable=no,location=no,status=no';

    window.open(content, title, winarg);

    return;

    /* TODO: */
    ///显示子页面
    if (type == 'iframe') {
        $("#menu_window").html("<iframe id='ifrme' name='ifrme' frameborder='0' scrolling='auto' width='" + width + "' height='" + height + "'></iframe>");
        $("#ifrme").attr("src", content);
    }
    ///用于 弹出子页面。。。若果没有下面的，OpenWindow只能在父页面显示子页面，不会弹出来。
    $("#menu_window").window({
        title: title, iconCls: 'icon-info', width: width + 15, height: height + 40, top: topsize, left: leftsize, resizable: false, modal: true, shadow: true,
        minimizable: false, maximizable: false, closable: true, closed: false, collapsible: false
    });
}
</script>



<!-- fix parts start -->
<BODY onload="load()">
<CENTER>
<TABLE width="100%">
<!-- The Page Header -->
<TR CLASS="OUTER">
<?php
    include "data/crc_page_header_band.html";
?>
</TR>
<!-- The Page Content -->
<TR CLASS="OUTER">
<!-- fix parts end -->


<form name="staffworkex" action="crc_handler.php?method=staff&func=updateworkex" method="post">
<input type="hidden" name="context" value="ou=Don Mills,ou=Toronto,ou=Ontario,ou=Canada,o=CRC World">
<input type="hidden" name="action">
<input type="hidden" name="workex_uid">
<input type="hidden" name="workex_id">
<table align="left">
	<tr>
		<td valign="top" width="180">
            <!-- This is the menu -->
            <?php
                include "../common/crc_menu.html";
            ?>
		</td>

		<td valign="top" align="left">
	    <!-- This is the content -->
        <table class="tbl">
		<tr>
            <th colspan="5" align="left">一、个人基本情况</th>
            <th>得分</th>
            <th></th>
		</tr>
		<tr>
            <td>姓名</td>
            <td><input type="text" name="bi_name" size="8" value=""></td>
            <td>出生日期</td>
            <td><input type="text" name="bi_birth" size="8" value=""></td>
            <td>参加工作时间</td>
            <td><input type="text" name="bi_fwd" size="8" value=""></td>
            <td></td>
		</tr>
		<tr>
            <td>员工编号</td>
            <td><input type="text" name="bi_no" size="8" value=""></td>
            <td>毕业院校</td>
            <td><input type="text" name="bi_gs" size="8" value=""></td>
            <td>专业</td>
            <td><input type="text" name="bi_major" size="8" value=""></td>
            <td></td>
		</tr>
		<tr>
            <td>现项目及岗位</td>
            <td><input type="text" name="bi_cpro" size="8" value=""></td>
            <td><select name="bi_cpos"><option value="9">项目总工</option>
                    <option value="8">项目副总工</option>
                    <option value="7">项目质量总监</option>
                    <option value="6">项目技术部经理</option>
                    <option value="5">项目质量部经理</option>
                    <option value="4">项目技术工程师</option>
                    <option value="3">项目质量工程师</option>
                    <option value="2">部门经理</option>
                    <option value="1">部门副经理</option>
                    <option value="0" selected="selected">部门技术质量工程师</option>
                    </select></td>
            <td>项目规模</td>
            <td><select name="bi_psca"><option value="3">特大型</option>
                    <option value="2">大型</option>
                    <option value="1">中小型</option>
                    <option value="0" selected="selected">无</option>
                    </select></td>
            <td>岗位得分</td>
            <td><input type="text" name="bi_ppscore" size="8" value=""></td>
		</tr>
		<tr>
            <td>学历</td>
            <td><select name="bi_edu"><option value="4">博士及以上</option>
                    <option value="3">硕士</option>
                    <option value="2">本科</option>
                    <option value="1">大专及以下</option>
                    <option value="0" selected="selected">其他</option>
                    </select></td>
            <td>学历得分</td>
            <td><input type="text" name="bi_eduscore" size="8" value=""></td>
            <td>本企业工龄</td>
            <td><select name="bi_cwy"><option value="4">12年以上</option>
                    <option value="3">8-12年（不含）</option>
                    <option value="2">4-8年（不含）</option>
                    <option value="1">4年以下</option>
                    <option value="0" selected="selected">无</option>
                    </select></td>
            <td></td>
		</tr>
		<tr>
            <td>职称</td>
            <td><select name="bi_wti"><option value="3">教授级高工</option>
                    <option value="2">高级工程师</option>
                    <option value="1">中级工程师</option>
                    <option value="0" selected="selected">其他</option>
                    </select></td>
            <td>职称得分</td>
            <td><input type="text" name="bi_wtiscore" size="8" value=""></td>
            <td>其他企业工龄</td>
            <td><select name="bi_owy"><option value="4">12年以上</option>
                    <option value="3">8-12年（不含）</option>
                    <option value="2">4-8年（不含）</option>
                    <option value="1">4年以下</option>
                    <option value="0" selected="selected">无</option>
                    </select></td>
            <td></td>
		</tr>
		<tr>
            <td>英语津贴</td>
            <td><select name="bi_eng"><option value="1">是</option>
                    <option value="0" selected="selected">否</option>
                    </select></td>
            <td>英语津贴得分</td>
            <td><input type="text" name="bi_engscore" size="8" value=""></td>
            <td>工龄得分</td>
            <td><input type="text" name="bi_wyscore" size="8" value=""></td>
            <td></td>
		</tr>
		<tr>
            <td>BIM证书</td>
            <td><select name="bi_bim"><option value="3">一级</option>
                    <option value="2">二级</option>
                    <option value="1">三级</option>
                    <option value="0" selected="selected">无</option>
                    </select></td>
            <td>BIM证书得分</td>
            <td><input type="text" name="bi_bimscore" size="8" value=""></td>
            <td colspan="3"></td>
		</tr>
		<tr>
            <td>注册类证书</td>
            <td><select name="bi_cer"><option value="3">一级建造师</option>
                    <option value="2">注册安全工程师</option>
                    <option value="1">注册造价工程师</option>
                    <option value="0" selected="selected">无</option>
                    </select></td>
            <td>增项或两张以上证书</td>
            <td><select name="bi_cer2"><option value="1">是</option>
                    <option value="0" selected="selected">否</option>
                    </select></td>
            <td>注册类证书得分</td>
            <td><input type="text" name="bi_cerscore" size="8" value=""></td>
            <td></td>
		</tr>
		<tr>
            <td>一年内活动参与次数</td>
            <td><input type="text" name="bi_act" size="8" value=""></td>
            <td>参与活动得分</td>
            <td><input type="text" name="bi_actscore" size="8" value=""></td>
            <td colspan="3"></td>
		</tr>
		<tr>
            <td>参与活动记录</td>
            <td colspan="6" ><textarea name="bi_actdesc" rows="5" cols="108" maxlength="540" value=""></textarea></td>
		</tr>
		<tr>
            <td colspan="7" align="center"><input id="bi_setbtn" type="button" onclick="setbi()" value="保存基本情况信息"></td>
		</tr>
        </table>


        <table class="tbl">
		<tr>
            <th colspan="5" align="left">三、业务经历</th>
            <th>得分</th>
            <th colspan="2"></th>
		</tr>
		<tr>
            <th colspan="5" align="left">1、公司部门工作经历<input type="button" onclick="btnaction('workex', 'add', g_uid, '1')" value="添加"></th>
            <th>小计</th>
            <th colspan="2"></th>
		</tr>
		<tr>
            <th>起始时间</th><th>年数</th><th>职务</th><th width="400">描述</th><th>得分</th><th width="200">备注</th><th colspan="2">操作</th>
            <!--<th colspan="2"></th>-->
		</tr>
        <script type="text/javascript">
        if ('workex' in g_data) {
            var workex = g_data.workex;
            for(var i=0; i<workex.length; i++)  
            {
                document.write('<tr>');
                document.write('<td>' + workex[i].workex_dure + '</td>');
                document.write('<td>' + workex[i].workex_year + '</td>');
                document.write('<td>' + workex[i].workex_position + '</td>');
                document.write('<td style="word-wrap:break-word" width="400">' + workex[i].workex_desc + '</td>');
                document.write('<td>' + workex[i].workex_score + '</td>');
                document.write('<td style="word-wrap:break-word" width="200">' + workex[i].workex_comment + '</td>');
                document.write('<td><input type="button" onclick="btnaction(\'workex\', \'edit\',' + g_uid + ',' + workex[i].workex_id + ')" value="修改"></td>');
                document.write('<td><input type="button" onclick="btnaction(\'workex\', \'delete\',' + g_uid + ',' + workex[i].workex_id + ')" value="删除"></td>');
                document.write('</tr>');
            }  
        }  
        </script>
      </table>
    </td>
  </tr>
</table>
</form>


<!-- fix parts start -->
</TR>
</TABLE>
</CENTER>
</BODY>
</HTML>
<!-- fix parts end -->
